<!DOCTYPE html>
<html>
<head>
  <title>Backup Automático</title>
</head>
<body>
  <h2>Status:</h2>
  <div id="status">Iniciando...</div>

  <script>
    const apiUrl = "https://api-chatgpt.github.io/ChatGPT-Api/AUTO-RESPONDER.html";
    const firebaseUrl = "https://chatgpt-api-9a719-default-rtdb.firebaseio.com/backup/server/txt.json";

    async function processar() {
      try {
        document.getElementById("status").innerText = "Buscando dados da API...";

        const respostaApi = await fetch(apiUrl);
        const dados = await respostaApi.json();

        const S1 = dados.S1;
        const S2 = dados.S2;

        if (!S1 || !S2) {
          document.getElementById("status").innerText = "Dados inválidos.";
          return;
        }

        document.getElementById("status").innerText = "Verificando Firebase...";
        const respostaFirebase = await fetch(firebaseUrl);
        let dadosFirebase = await respostaFirebase.json();

        if (!Array.isArray(dadosFirebase)) {
          dadosFirebase = [];
        }

        const existe = dadosFirebase.some(item => item.pergunta === S1);

        if (existe) {
          document.getElementById("status").innerText = "Pergunta já cadastrada.";
          return;
        }

        const novoItem = {
          pergunta: S1,
          resposta: S2,
          id: Date.now()
        };

        dadosFirebase.push(novoItem);

        document.getElementById("status").innerText = "Salvando no Firebase...";
        await fetch(firebaseUrl, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(dadosFirebase)
        });

        document.getElementById("status").innerText = "Pergunta salva com sucesso!";
      } catch (err) {
        document.getElementById("status").innerText = "Erro: " + err.message;
        console.error(err);
      }
    }

    processar();
  </script>
</body>
</html>